<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Financial Forest 3D Visualization</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #111;
            color: #eee;
            display: flex;
            height: 100vh;
        }

        /* å·¦å´ã®3Dã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¨ãƒªã‚¢ */
        #canvas-container {
            flex-grow: 1; /* æ®‹ã‚Šã®å¹…ã‚’ã™ã¹ã¦ä½¿ã† */
            position: relative;
            outline: none;
        }

        /* å³å´ã®æƒ…å ±ãƒ‘ãƒãƒ« */
        #info-panel {
            width: 320px;
            background-color: #1e1e1e;
            border-left: 1px solid #333;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 15px rgba(0,0,0,0.5);
        }

        h1 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #444;
            padding-bottom: 0.5rem;
            color: #4db8ff;
        }

        .placeholder {
            color: #888;
            font-style: italic;
            margin-top: 20px;
            text-align: center;
        }

        /* è²¡å‹™ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        .metric-label {
            color: #aaa;
        }
        .metric-value {
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢ã®ãƒãƒƒã‚¸ */
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .legend {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #333;
            font-size: 0.8rem;
            color: #666;
        }
        .legend-item {
            margin-bottom: 5px;
        }
    </style>

    <!-- Import map for Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <!-- 3Dæç”»é ˜åŸŸ -->
    <div id="canvas-container"></div>

    <!-- æƒ…å ±ãƒ‘ãƒãƒ« -->
    <div id="info-panel">
        <h1>éŠ˜æŸ„è©³ç´°</h1>
        <div id="stock-details">
            <div class="placeholder">
                <p>æ£®ã®ä¸­ã‹ã‚‰æœ¨ï¼ˆéŠ˜æŸ„ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                <p>ãƒ‰ãƒ©ãƒƒã‚°ã§å›è»¢ã€ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ ã§ãã¾ã™ã€‚</p>
            </div>
        </div>
        
        <div class="legend">
            <strong>ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å‡¡ä¾‹:</strong>
            <div class="legend-item">ğŸŒ² é«˜ã•: æ™‚ä¾¡ç·é¡ (å¤§)</div>
            <div class="legend-item">ğŸªµ å¹¹ã®å¤ªã•: è‡ªå·±è³‡æœ¬æ¯”ç‡ (é«˜)</div>
            <div class="legend-item">ğŸƒ è‘‰ã®é‡: åˆ©ç›Šç‡ (é«˜)</div>
            <div class="legend-item">ğŸ¨ è‘‰ã®è‰²: é’=å‰²å®‰ / èµ¤=å‰²é«˜</div>
            <div class="legend-item">ğŸ‹ æœå®Ÿ: é…å½“åˆ©å›ã‚Š (å¤š)</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ---------------------------------------------------------
        // 1. ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³
        // ---------------------------------------------------------

        // 20éŠ˜æŸ„åˆ†ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function generateDummyStocks(count) {
            const stocks = [];
            const sectors = ["Tech", "Auto", "Bank", "Food", "Chem", "Retail"];
            
            for (let i = 0; i < count; i++) {
                // ãƒ©ãƒ³ãƒ€ãƒ ãªè²¡å‹™æ•°å€¤ã‚’ç”Ÿæˆ
                const marketCap = Math.floor(Math.random() * 20000) + 500; // 500 ~ 20500 å„„å††
                const equityRatio = 0.1 + Math.random() * 0.8; // 10% ~ 90%
                const roe = -0.05 + Math.random() * 0.25; // -5% ~ 20%
                const operatingMargin = 0.01 + Math.random() * 0.3; // 1% ~ 31%
                
                // PER/PBRã¯ç›¸é–¢ã‚’æŒãŸã›ãšãƒ©ãƒ³ãƒ€ãƒ ã«æŒ¯ã‚‹ï¼ˆãƒãƒªãƒ¥ãƒ¼åˆ¤å®šã®ãŸã‚ï¼‰
                const pbr = 0.3 + Math.random() * 4.0; // 0.3 ~ 4.3å€
                // PERã¯ç•°å¸¸å€¤ã‚’é¿ã‘ã‚‹ãŸã‚ç°¡æ˜“è¨ˆç®—
                const per = (Math.random() * 40) + 5; // 5 ~ 45å€

                const dividendYield = Math.random() < 0.2 ? 0 : (Math.random() * 0.06); // 20%ã¯ç„¡é…ã€ä»–ã¯0~6%
                const fcfMargin = operatingMargin * (0.5 + Math.random() * 0.5); // å–¶æ¥­åˆ©ç›Šã«è¿‘ã„å‹•ã

                // ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢è¨ˆç®— (è¦ä»¶ã«åŸºã¥ã)
                // pbrScore: PBR 1.5ä»¥ä¸‹ãªã‚‰ã‚¹ã‚³ã‚¢ãŒé«˜ããªã‚‹
                const pbrScore = Math.max(0, Math.min(1, 1.5 - pbr)); 
                // perScore: PER 20ä»¥ä¸‹ãªã‚‰ã‚¹ã‚³ã‚¢ãŒé«˜ããªã‚‹
                const perScore = Math.max(0, Math.min(1, (20 - per) / 20));
                
                // ç·åˆãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢ (0: å‰²é«˜/ã‚°ãƒ­ãƒ¼ã‚¹, 1: è¶…å‰²å®‰)
                let valueScore = 0.6 * pbrScore + 0.4 * (per < 0 ? 0 : (20 - Math.max(0, per)) / 20);
                // ç°¡æ˜“è£œæ­£ï¼ˆè² ã®PERãªã©ã¯é™¤å¤–ã—ã¦ã‚¹ã‚³ã‚¢åŒ–ï¼‰
                if(per < 0) valueScore = 0; 
                else {
                    const rawPerScore = Math.max(0, Math.min(1, (25 - per) / 25));
                    const rawPbrScore = Math.max(0, Math.min(1, (2.0 - pbr) / 2.0));
                    valueScore = (rawPerScore + rawPbrScore) / 2;
                }

                stocks.push({
                    ticker: `${sectors[i % sectors.length].substring(0,1)}${1000 + i}`,
                    name: `${sectors[i % sectors.length]} Corp ${i+1}`,
                    marketCap,
                    equityRatio,
                    roe,
                    operatingMargin,
                    pbr,
                    per,
                    dividendYield,
                    fcfMargin,
                    valueScore // è¨ˆç®—æ¸ˆã¿ã‚¹ã‚³ã‚¢ã‚’æŒãŸã›ã‚‹
                });
            }
            return stocks;
        }

        const stocks = generateDummyStocks(20);

        // ãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§å€¤ãƒ»æœ€å°å€¤ã‚’è¨ˆç®—ï¼ˆæ­£è¦åŒ–ç”¨ï¼‰
        const maxCap = Math.max(...stocks.map(s => s.marketCap));
        const minCap = Math.min(...stocks.map(s => s.marketCap));
        
        // ---------------------------------------------------------
        // 2. Three.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        // ---------------------------------------------------------
        
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x222222); // ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯
        scene.fog = new THREE.Fog(0x222222, 20, 80);  // é ãã‚’ã¼ã‹ã™

        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 20, 40);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // åœ°é¢ï¼ˆã‚°ãƒªãƒƒãƒ‰ï¼‰
        const gridHelper = new THREE.GridHelper(100, 50, 0x444444, 0x333333);
        scene.add(gridHelper);

        // ---------------------------------------------------------
        // 3. æœ¨ï¼ˆéŠ˜æŸ„ï¼‰ã®ä½œæˆãƒ­ã‚¸ãƒƒã‚¯
        // ---------------------------------------------------------

        const treeGroup = new THREE.Group();
        scene.add(treeGroup);

        // è‰²ã®è¨ˆç®—ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
        // èµ¤(å‰²é«˜) -> é»„(ä¸­ç«‹) -> é’ç·‘(å‰²å®‰)
        const colorExpensive = new THREE.Color(0xff4d4d); // Red/Orange
        const colorFair = new THREE.Color(0xffd633);      // Yellow
        const colorCheap = new THREE.Color(0x00cc99);     // Teal/Green

        function getFoliageColor(score) {
            const color = new THREE.Color();
            if (score < 0.5) {
                // 0.0(Exp) -> 0.5(Fair)
                const t = score / 0.5;
                color.lerpColors(colorExpensive, colorFair, t);
            } else {
                // 0.5(Fair) -> 1.0(Cheap)
                const t = (score - 0.5) / 0.5;
                color.lerpColors(colorFair, colorCheap, t);
            }
            return color;
        }

        // å„éŠ˜æŸ„ã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦é…ç½®
        const cols = 5; // 5åˆ—ã§æŠ˜ã‚Šè¿”ã—
        const spacing = 8; // æœ¨ã®é–“éš”

        stocks.forEach((stock, index) => {
            // === ãƒ‡ãƒ¼ã‚¿ã®æ­£è¦åŒ– ===
            // é«˜ã•: MarketCap (æœ€å°2, æœ€å¤§12ãã‚‰ã„ã®ç¯„å›²ã«åã‚ã‚‹)
            const heightScale = 2 + ((stock.marketCap - minCap) / (maxCap - minCap)) * 10;
            
            // å¤ªã•: EquityRatio (0.1~1.0 -> åŠå¾„ 0.2~0.8)
            const radiusScale = 0.2 + stock.equityRatio * 0.6;

            // è‘‰ã®å¤§ãã•: OperatingMargin (å¤§ãã„ã»ã©è‘‰ãŒèŒ‚ã‚‹)
            // ãƒã‚¤ãƒŠã‚¹ã®å ´åˆã¯å°ã•ãã™ã‚‹
            const foliageScale = Math.max(0.8, 1.0 + stock.operatingMargin * 4);

            // === 3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ ===
            const stockObj = new THREE.Group();

            // 1. å¹¹ (Cylinder)
            const trunkGeo = new THREE.CylinderGeometry(radiusScale * 0.7, radiusScale, heightScale, 12);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.y = heightScale / 2; // åœ°é¢ã«åº•é¢ãŒã¤ãã‚ˆã†ã«
            trunk.castShadow = true;
            stockObj.add(trunk);

            // 2. å†  / è‘‰ (Icosahedron or Dodecahedron for low poly look)
            const foliageGeo = new THREE.DodecahedronGeometry(1);
            const foliageColor = getFoliageColor(stock.valueScore);
            const foliageMat = new THREE.MeshStandardMaterial({ 
                color: foliageColor,
                flatShading: true 
            });
            
            // è‘‰ã‚’è¤‡æ•°é‡ã­ã¦ãƒœãƒªãƒ¥ãƒ¼ãƒ æ„Ÿã‚’å‡ºã™
            const foliageCount = 3;
            for(let j=0; j<foliageCount; j++) {
                const leaf = new THREE.Mesh(foliageGeo, foliageMat);
                // å¹¹ã®ä¸Šã«é…ç½®ã€‚å°‘ã—ãƒ©ãƒ³ãƒ€ãƒ ã«æ•£ã‚‰ã™
                const yBase = heightScale;
                leaf.position.set(
                    (Math.random() - 0.5) * radiusScale * 2,
                    yBase + (Math.random() * 1.5),
                    (Math.random() - 0.5) * radiusScale * 2
                );
                const s = foliageScale * (0.8 + Math.random() * 0.4);
                leaf.scale.set(s, s, s);
                leaf.castShadow = true;
                stockObj.add(leaf);

                // 3. ãƒ•ãƒ«ãƒ¼ãƒ„ (Dividend Yield)
                // é…å½“åˆ©å›ã‚Šã«å¿œã˜ã¦ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’è¿½åŠ 
                // yield 3% -> 3å€‹ãã‚‰ã„, 5% -> 5å€‹ãã‚‰ã„
                const fruitCount = Math.floor(stock.dividendYield * 100); 
                if (fruitCount > 0 && j === 0) { // æœ€åˆã®è‘‰ã®å¡Šã®å‘¨è¾ºã«ç”Ÿæˆ
                    const fruitGeo = new THREE.SphereGeometry(0.2, 8, 8);
                    const fruitMat = new THREE.MeshStandardMaterial({ 
                        color: 0xffaa00, 
                        emissive: 0xff4400,
                        emissiveIntensity: 0.2
                    });
                    
                    for(let f=0; f<fruitCount; f++) {
                        const fruit = new THREE.Mesh(fruitGeo, fruitMat);
                        // è‘‰ã®ä¸­å¿ƒã‹ã‚‰å°‘ã—é›¢ã‚ŒãŸè¡¨é¢ä»˜è¿‘ã«é…ç½®
                        const theta = Math.random() * Math.PI * 2;
                        const phi = Math.random() * Math.PI;
                        const r = s * 0.9; // è‘‰ã®åŠå¾„ã‚ˆã‚Šå°‘ã—å†…å´ã‹è¡¨é¢
                        fruit.position.set(
                            leaf.position.x + r * Math.sin(phi) * Math.cos(theta),
                            leaf.position.y + r * Math.sin(phi) * Math.sin(theta),
                            leaf.position.z + r * Math.cos(phi)
                        );
                        stockObj.add(fruit);
                    }
                }
            }

            // é…ç½® (æ ¼å­çŠ¶)
            const row = Math.floor(index / cols);
            const col = index % cols;
            // ä¸­å¿ƒã‚’åŸç‚¹ã«ã™ã‚‹ãŸã‚ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
            const offsetX = (cols * spacing) / 2;
            const offsetZ = (Math.ceil(stocks.length / cols) * spacing) / 2;

            stockObj.position.set(
                col * spacing - offsetX + (spacing/2),
                0,
                row * spacing - offsetZ + (spacing/2)
            );

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦éŠ˜æŸ„æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€
            stockObj.userData = { isStock: true, data: stock, originalScale: 1.0 };
            
            treeGroup.add(stockObj);
        });

        // ---------------------------------------------------------
        // 4. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ (Raycaster)
        // ---------------------------------------------------------

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedObject = null;

        // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
        renderer.domElement.addEventListener('pointerdown', onPointerDown);

        function onPointerDown(event) {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹å†…ã®åº§æ¨™ã«å¤‰æ›
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            // äº¤å·®åˆ¤å®šï¼ˆå†å¸°çš„ã«å­è¦ç´ ã‚‚ãƒã‚§ãƒƒã‚¯ï¼‰
            const intersects = raycaster.intersectObjects(treeGroup.children, true);

            if (intersects.length > 0) {
                // ã‚¯ãƒªãƒƒã‚¯ã—ãŸãƒ¡ãƒƒã‚·ãƒ¥ã®è¦ªã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆStock Objectï¼‰ã‚’æ¢ã™
                let target = intersects[0].object;
                while(target.parent && target.parent !== treeGroup) {
                    target = target.parent;
                }

                if (target.userData.isStock) {
                    selectStock(target);
                }
            } else {
                deselectStock();
            }
        }

        function selectStock(object) {
            // å‰ã®é¸æŠã‚’è§£é™¤
            if (selectedObject && selectedObject !== object) {
                selectedObject.scale.setScalar(1);
                // ã‚¨ãƒŸãƒƒã‚·ãƒ–ï¼ˆç™ºå…‰ï¼‰ã‚’æˆ»ã™ãªã©ã®å‡¦ç†ãŒã‚ã‚Œã°ã“ã“
            }

            selectedObject = object;
            
            // é¸æŠã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå°‘ã—å¤§ããã™ã‚‹ï¼‰
            object.scale.setScalar(1.2);

            // UIæ›´æ–°
            updateInfoPanel(object.userData.data);
        }

        function deselectStock() {
            if (selectedObject) {
                selectedObject.scale.setScalar(1);
                selectedObject = null;
            }
            // UIãƒªã‚»ãƒƒãƒˆ
            document.getElementById('stock-details').innerHTML = `
                <div class="placeholder">
                    <p>æ£®ã®ä¸­ã‹ã‚‰æœ¨ï¼ˆéŠ˜æŸ„ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            `;
        }

        function updateInfoPanel(data) {
            const detailsDiv = document.getElementById('stock-details');
            
            // æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            const fmtYen = (v) => v.toLocaleString();
            const fmtPct = (v) => (v * 100).toFixed(1) + '%';
            const fmtX = (v) => v.toFixed(2) + 'x';

            // ãƒãƒªãƒ¥ãƒ¼ã‚¹ã‚³ã‚¢åˆ¤å®šãƒ†ã‚­ã‚¹ãƒˆã¨è‰²
            let scoreText = "ãƒ•ã‚§ã‚¢ãƒãƒªãƒ¥ãƒ¼";
            let badgeColor = "#e6b800"; // yellow
            if (data.valueScore > 0.66) {
                scoreText = "ãƒ‡ã‚£ãƒ¼ãƒ—ãƒãƒªãƒ¥ãƒ¼ (å‰²å®‰)";
                badgeColor = "#00cc99"; // green
            } else if (data.valueScore < 0.33) {
                scoreText = "ã‚°ãƒ­ãƒ¼ã‚¹ / å‰²é«˜";
                badgeColor = "#ff4d4d"; // red
            }

            const html = `
                <div style="margin-bottom:15px;">
                    <h2 style="margin:0; color:#fff;">${data.ticker}</h2>
                    <div style="color:#ccc; font-size:0.9rem;">${data.name}</div>
                </div>

                <div class="badge" style="background-color: ${badgeColor};">
                    ${scoreText} (Score: ${data.valueScore.toFixed(2)})
                </div>

                <div class="metric-row">
                    <span class="metric-label">æ™‚ä¾¡ç·é¡ (é«˜ã•)</span>
                    <span class="metric-value">${fmtYen(data.marketCap)} å„„å††</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">è‡ªå·±è³‡æœ¬æ¯”ç‡ (å¤ªã•)</span>
                    <span class="metric-value">${fmtPct(data.equityRatio)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">å–¶æ¥­åˆ©ç›Šç‡ (è‘‰é‡)</span>
                    <span class="metric-value">${fmtPct(data.operatingMargin)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">FCFãƒãƒ¼ã‚¸ãƒ³</span>
                    <span class="metric-value">${fmtPct(data.fcfMargin)}</span>
                </div>
                <hr style="border-color:#444;">
                <div class="metric-row">
                    <span class="metric-label">PER</span>
                    <span class="metric-value">${fmtX(data.per)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">PBR</span>
                    <span class="metric-value">${fmtX(data.pbr)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ROE</span>
                    <span class="metric-value">${fmtPct(data.roe)}</span>
                </div>
                <div class="metric-row" style="color:${data.dividendYield > 0.03 ? '#ffaa00' : 'inherit'}">
                    <span class="metric-label">é…å½“åˆ©å›ã‚Š (æœå®Ÿ)</span>
                    <span class="metric-value">${fmtPct(data.dividendYield)}</span>
                </div>
            `;
            detailsDiv.innerHTML = html;
        }

        // ---------------------------------------------------------
        // 5. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        // ---------------------------------------------------------

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            // é¸æŠä¸­ã®æœ¨ã‚’å°‘ã—å›è»¢ã•ã›ã‚‹æ¼”å‡º
            if (selectedObject) {
                selectedObject.rotation.y += 0.01;
            }

            renderer.render(scene, camera);
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', () => {
            const width = container.clientWidth;
            const height = container.clientHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });

        animate();

    </script>
</body>
</html>
